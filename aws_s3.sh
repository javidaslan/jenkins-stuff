#/bin/bash

DB_HOST=$1
DB_PASSWORD=$2
DB_NAME=$3
AWS_ACCESS_KEY_ID=$4
AWS_SECRET_ACCESS_KEY=$5
BUCKET_NAME=$6
DATE=$(date +%H%M%S)
FILENAME=/tmp/db-$DATE.sql

echo $DB_PASSWORD

mysqldump -u root -h $DB_HOST -p$DB_PASSWORD $DB_NAME > $FILENAME && \
export AWS_ACCESS_KEY_ID=$AWS_ACCESS_KEY_ID && \
export AWS_SECRET_ACCESS_KEY=$AWS_SECRET_ACCESS_KEY && \
aws s3 cp $FILENAME s3://$BUCKET_NAME/db-$DATE.sql
